<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Phylogenetic conservation prioritization — ps_prioritize • phylospatial</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Phylogenetic conservation prioritization — ps_prioritize"><meta name="description" content="Create a ranking of conservation priorities using optimal or probabilistic forward stepwise selection. Prioritization accounts for
the occurrence quantities for all lineages present in the site, including terminal taxa and larger clades; the evolutionary branch
lengths of these lineages on the phylogeny, which represent their unique evolutionary heritage; the impact that protecting the site
would have on these lineages' range-wide protection levels; the compositional complementarity between the site, other high-priority
sites, and existing protected areas; the site's initial protection level; the relative cost of protecting the site; and a free
parameter &quot;lambda&quot; determining the shape of the conservation benefit function."><meta property="og:description" content="Create a ranking of conservation priorities using optimal or probabilistic forward stepwise selection. Prioritization accounts for
the occurrence quantities for all lineages present in the site, including terminal taxa and larger clades; the evolutionary branch
lengths of these lineages on the phylogeny, which represent their unique evolutionary heritage; the impact that protecting the site
would have on these lineages' range-wide protection levels; the compositional complementarity between the site, other high-priority
sites, and existing protected areas; the site's initial protection level; the relative cost of protecting the site; and a free
parameter &quot;lambda&quot; determining the shape of the conservation benefit function."><meta property="og:image" content="https://matthewkling.github.io/phylospatial/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phylospatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/phylospatial-data.html">Spatial phylogentic data</a></li>
    <li><a class="dropdown-item" href="../articles/alpha-diversity.html">Alpha phylogenetic diversity</a></li>
    <li><a class="dropdown-item" href="../articles/beta-diversity.html">Phylogenetic beta diversity</a></li>
    <li><a class="dropdown-item" href="../articles/prioritization.html">Conservation prioritization</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Phylogenetic conservation prioritization</h1>

      <div class="d-none name"><code>ps_prioritize.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a ranking of conservation priorities using optimal or probabilistic forward stepwise selection. Prioritization accounts for
the occurrence quantities for all lineages present in the site, including terminal taxa and larger clades; the evolutionary branch
lengths of these lineages on the phylogeny, which represent their unique evolutionary heritage; the impact that protecting the site
would have on these lineages' range-wide protection levels; the compositional complementarity between the site, other high-priority
sites, and existing protected areas; the site's initial protection level; the relative cost of protecting the site; and a free
parameter "lambda" determining the shape of the conservation benefit function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ps_prioritize</span><span class="op">(</span></span>
<span>  <span class="va">ps</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cost <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  protection <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"optimal"</span>, <span class="st">"probable"</span><span class="op">)</span>,</span>
<span>  trans <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">25</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  n_reps <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  summarize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spatial <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ps">ps<a class="anchor" aria-label="anchor" href="#arg-ps"></a></dt>
<dd><p>phylospatial object.</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>Optional numeric vector or spatial object giving the starting protection status of each site across the study area.
Values should be between 0 and 1 and represent the existing level of conservation effectiveness in each site. If this argument
is not specified, it is assumed that no existing reserves are present.</p></dd>


<dt id="arg-cost">cost<a class="anchor" aria-label="anchor" href="#arg-cost"></a></dt>
<dd><p>Optional numeric vector or spatial object giving the relative cost of protecting each site. Values should be positive,
with greater values indicating higher cost of conserving a site. If this argument is not specified, cost is assumed to be uniform
across sites.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>Shape parameter for taxon conservation benefit function. This can be any real number. Positive values, such as the default
value <code>1</code>, place higher priority on conserving the first part of the range of a given species or clade, while negative values
(which are not typically used) place higher priority on fully protecting the most important taxa (those with small ranges and long branches)
rather than partially protecting all taxa. See the function <a href="plot_lambda.html">plot_lambda</a> for an illustration of alternative <code>lambda</code> values.</p></dd>


<dt id="arg-protection">protection<a class="anchor" aria-label="anchor" href="#arg-protection"></a></dt>
<dd><p>Degree of protection of proposed new reserves (number between 0 and 1, with same meaning as <code>init</code>).</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>Integer giving max number of iterations to perform before stopping, i.e. max number of sites to rank.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Procedure for selecting which site to add to the reserve network at each iteration:</p><ul><li><p>"optimal": The default, this selects the site with the highest marginal value at each iteration. This is a
optimal approach that gives the same result each time.</p></li>
<li><p>"probable": This option selects a site randomly, with selection probabilities calculated as a function of sites' marginal values. This
approach gives a different prioritization ranking each time an optimization is performed, so <code>n_reps</code> optimizations are performed,
and ranks for each site are summarized across repetitions.</p></li>
</ul></dd>


<dt id="arg-trans">trans<a class="anchor" aria-label="anchor" href="#arg-trans"></a></dt>
<dd><p>A function that transforms marginal values into relative selection probabilities; only used if <code>method = "probable"</code>.
The function should take a vector of positive numbers representing marginal values and return an equal-length vector of positive numbers
representing a site's relative likelihood of being selected. The default function returns the marginal value if a site is in the top 25
highest-value sites, and zero otherwise.</p></dd>


<dt id="arg-n-reps">n_reps<a class="anchor" aria-label="anchor" href="#arg-n-reps"></a></dt>
<dd><p>Number of random repetitions to do; only used if <code>method = "probable"</code>. Depending on the data set, a large number of reps
(more than the default of 100) may be needed in order to achieve a stable result. This may be a computational barrier for large data
sets; multicore processing via <code>n_cores</code> can help.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>Number of compute cores to use for parallel processing; only used if <code>method = "probable"</code>.</p></dd>


<dt id="arg-summarize">summarize<a class="anchor" aria-label="anchor" href="#arg-summarize"></a></dt>
<dd><p>Logical: should summary statistics across reps (TRUE, default) or the reps themselves (FALSE) be returned? Only relevant
if <code>method = "probable"</code>.</p></dd>


<dt id="arg-spatial">spatial<a class="anchor" aria-label="anchor" href="#arg-spatial"></a></dt>
<dd><p>Logical: should the function return a spatial object (TRUE, default) or a matrix (FALSE)?</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Logical: should a progress bar be displayed?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Matrix or spatial object containing a ranking of conservation priorities. Lower rank values represent higher
conservation priorities. All sites with a lower priority than <code>max_iter</code> have a rank value equal to the number
of sites in the input data set (i.e. the lowest possible priority).</p><dl><dt>If <code>method = "optimal"</code>. </dt>
<dd><p>the result contains a single variable "priority" containing the ranking.</p></dd>

<dt>If <code>method = "probable"</code> and <code>summarize = TRUE</code>, </dt>
<dd><p>the "priority" variable gives the average rank across reps,
variables labeled "pctX" give the Xth percentile of the rank distribution for each site, variables labeled "topX"
give the proportion of reps in which a site was in the top X highest-priority sites, and variables labeled "treX" give
a ratio representing "topX" relative to the null expectation of how often "topX" should occur by chance alone.</p></dd>

<dt>If <code>method = "probable"</code> and <code>summarize = FALSE</code>, </dt>
<dd><p>the result contains the full set of <code>n_rep</code> solutions,
each representing the the ranking, with low values representing higher priorities..</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function uses the forward stepwise selection algorithm of Kling et al. (2019) to generate a ranked conservation prioritization.
Prioritization begins with the starting protected lands network identified in <code>init</code>, if provided. At each iteration, the marginal
conservation value of fully protecting each site is calculated, and a site is selected to be added to the reserve network. Selection can
happen either in an "optimal" or "probable" fashion as described under the <code>method</code> argument. This process is repeated until all sites
are fully protected or until <code>max_iter</code> has been reached, with sites selected early in the process considered higher conservation
priorities.</p>
<p>The benefit of the probabilistic approach is that it relaxes the potentially unrealistic assumption that protected land will actually be
added in the optimal order. Since the algorithm avoids compositional redundancy between high-priority sites, the optimal approach will
never place high priority on a site that has high marginal value but is redundant with a slightly higher-value site, whereas the
probabilistic approach will select them at similar frequencies (though never in the same randomized run).</p>
<p>Every time a new site is protected as the algorithm progresses, it changes the marginal conservation value of the other sites. Marginal
value is the increase in conservation benefit that would arise from fully protecting a given site, divided by the cost of protecting the
site. This is calculated as a function of the site's current protection level, the quantitative presence probability or abundance of all
terminal taxa and larger clades present in the site, their evolutionary branch lengths on the phylogeny, the impact that protecting the
site would have on their range-wide protection levels, and the free parameter <code>lambda</code>. <code>lambda</code> determines the relative importance of
protecting a small portion of every taxon's range, versus fully protecting the ranges of more valuable taxa (those with longer
evolutionary branches and smaller geographic ranges).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kling, M. M., Mishler, B. D., Thornhill, A. H., Baldwin, B. G., &amp; Ackerly, D. D. (2019). Facets of phylodiversity: evolutionary
diversification, divergence and survival as conservation targets. Philosophical Transactions of the Royal Society B, 374(1763), 20170397.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="benefit.html">benefit()</a></code>, <code><a href="plot_lambda.html">plot_lambda()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># simulate a toy `phylospatial` data set</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="ps_simulate.html">ps_simulate</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># basic prioritization</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ps_prioritize</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specifying locations of initial protected areas</span></span></span>
<span class="r-in"><span><span class="co"># (can be binary, or can be continuous values between 0 and 1)</span></span></span>
<span class="r-in"><span><span class="co"># here we'll create an `init` raster with arbitrary values ranging from 0-1,</span></span></span>
<span class="r-in"><span><span class="co"># using the reference raster layer that's part of our `phylospatial` object</span></span></span>
<span class="r-in"><span><span class="va">protected</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">spatial</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">spatial</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ps_prioritize</span><span class="op">(</span><span class="va">ps</span>, init <span class="op">=</span> <span class="va">protected</span>, cost <span class="op">=</span> <span class="va">cost</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using probabilistic prioritization</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ps_prioritize</span><span class="op">(</span><span class="va">ps</span>, init <span class="op">=</span> <span class="va">protected</span>, cost <span class="op">=</span> <span class="va">cost</span>,</span></span>
<span class="r-in"><span>      method <span class="op">=</span> <span class="st">"prob"</span>, n_reps <span class="op">=</span> <span class="fl">1000</span>, max_iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">top10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ps_prioritize-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

