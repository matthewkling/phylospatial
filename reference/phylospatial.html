<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a spatial phylogenetic object — phylospatial • phylospatial</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a spatial phylogenetic object — phylospatial"><meta name="description" content="This function creates a phylospatial object. This is the core data type in the phylospatial library, and
is a required input to most other functions in the package. The two essential components of a spatial phylogenetic object
are a phylogenetic tree and an community data set."><meta property="og:description" content="This function creates a phylospatial object. This is the core data type in the phylospatial library, and
is a required input to most other functions in the package. The two essential components of a spatial phylogenetic object
are a phylogenetic tree and an community data set."><meta property="og:image" content="https://matthewkling.github.io/phylospatial/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phylospatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/phylospatial-data.html">Spatial phylogentic data</a></li>
    <li><a class="dropdown-item" href="../articles/alpha-diversity.html">Alpha phylogenetic diversity</a></li>
    <li><a class="dropdown-item" href="../articles/beta-diversity.html">Phylogenetic beta diversity</a></li>
    <li><a class="dropdown-item" href="../articles/prioritization.html">Conservation prioritization</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matthewkling/phylospatial/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create a spatial phylogenetic object</h1>
      <small class="dont-index">Source: <a href="https://github.com/matthewkling/phylospatial/blob/master/R/phylospatial.R" class="external-link"><code>R/phylospatial.R</code></a></small>
      <div class="d-none name"><code>phylospatial.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function creates a <code>phylospatial</code> object. This is the core data type in the phylospatial library, and
is a required input to most other functions in the package. The two essential components of a spatial phylogenetic object
are a phylogenetic tree and an community data set.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">phylospatial</span><span class="op">(</span></span>
<span>  <span class="va">comm</span>,</span>
<span>  tree <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spatial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"probability"</span>, <span class="st">"binary"</span>, <span class="st">"abundance"</span>, <span class="st">"other"</span><span class="op">)</span>,</span>
<span>  clade_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  build <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  area_tol <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-comm">comm<a class="anchor" aria-label="anchor" href="#arg-comm"></a></dt>
<dd><p>Community data representing the distribution of terminal taxa across sites. Can be a matrix with a column per terminal and
a row per site, a <a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">SpatRaster</a> with one layer per terminal, or a <code>sf</code> data with a column per terminal. Taxa whose names do
not match between column/layer names in <code>comm</code> and tip labels in <code>tree</code> will be dropped with a warning (unless <code>build = FALSE</code>).</p></dd>


<dt id="arg-tree">tree<a class="anchor" aria-label="anchor" href="#arg-tree"></a></dt>
<dd><p>Phylogeny of class <a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">phylo</a>. Terminals whose names do not match <code>comm</code> will be dropped with a warning (unless
<code>build = FALSE</code>). If this argument is not provided, terminals are assumed to follow a "star" tree with uniform branch lengths, which
will lead to non-phylogenetic versions of any analyses done with the resulting <code>phylospatial</code> object. Must be a rooted tree.</p></dd>


<dt id="arg-spatial">spatial<a class="anchor" aria-label="anchor" href="#arg-spatial"></a></dt>
<dd><p>An optional <code>SpatRaster</code> layer or <code>sf</code> object indicating site locations. The number of cells or rows must match <code>comm</code>.
Ignored if <code>comm</code> is a <code>SpatRaster</code> or <code>sf</code> object.</p></dd>


<dt id="arg-data-type">data_type<a class="anchor" aria-label="anchor" href="#arg-data-type"></a></dt>
<dd><p>Character giving the data type of <code>comm</code>. Must be "binary", "probability", "abundance", "auto" (the default), or "other".
This determines how community values for clades are calculated from the values for terminal taxa. If "binary" (presence-absence),
a clade is considered present in a site if any terminal in the clade is present. If "probability," clade probabilities are calculated
as the probability that at least one terminal is present in a site. If "abundance," clade abundances are calculated as the sum of
abundances for terminals in the clade in a site. If "auto," an attempt is made to guess which of these three data types was provided.
This argument is ignored if <code>clade_fun</code> is provided, or if <code>build = FALSE</code>. If "other", a custom <code>clade_fun</code> must be supplied.</p></dd>


<dt id="arg-clade-fun">clade_fun<a class="anchor" aria-label="anchor" href="#arg-clade-fun"></a></dt>
<dd><p>Function to calculate the local community weight for a clade based on community weights for tips found in a given location.
Must be either NULL (the default, in which case the default function for the selected <code>data_type</code> is used) or a summary function that
takes a numeric vector and returns a single numeric output. Ignored if <code>comm</code> already includes clade ranges.</p></dd>


<dt id="arg-build">build<a class="anchor" aria-label="anchor" href="#arg-build"></a></dt>
<dd><p>Logical indicating whether <code>comm</code> already includes clade ranges that should be used instead of building new ones.
Default is <code>TRUE</code>. If <code>FALSE</code>, <code>clade_fun</code> is ignored, no checks are performed to harmonize the tip labels and the community data, and
the columns of <code>comm</code> must exactly match the order of <code>tree</code> edges including tips and larger clades. If clade ranges are included in
<code>comm</code> but <code>build = TRUE</code>, they will be dropped and new clade ranges will be built.</p></dd>


<dt id="arg-check">check<a class="anchor" aria-label="anchor" href="#arg-check"></a></dt>
<dd><p>Logical indicating whether community data should be validated. Default is TRUE.</p></dd>


<dt id="arg-area-tol">area_tol<a class="anchor" aria-label="anchor" href="#arg-area-tol"></a></dt>
<dd><p>Numeric value giving tolerance for variation in the area of sites. Default is <code>0.01</code>. If the coefficient of variation in
the area or length of spatial units (e.g. grid cells) exceeds this value, an error will result. This check is performed because various
other functions in the library assume that sites are equal area. This argument is ignored if <code>check = FALSE</code> or if no spatial data is provided.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>phylospatial</code> object, which is a list containing the following elements:</p><dl><dt>"data_type":</dt>
<dd><p>Character indicating the community data type</p></dd>

<dt>"tree":</dt>
<dd><p>Phylogeny of class <code>phylo</code></p></dd>

<dt>"comm":</dt>
<dd><p>Community matrix, including a column for every terminal taxon and every larger clade. Column order corresponds to tree edge order.</p></dd>

<dt>"spatial":</dt>
<dd><p>A <code>SpatRaster</code> or <code>sf</code> providing spatial coordinates for the rows in <code>comm</code>. May be missing if no spatial data was supplied.</p></dd>

<dt>"dissim":</dt>
<dd><p>A community dissimilary matrix of class <code>dist</code> indicating pairwise phylogenetic dissimilarity between sites. Missing unless
<code>ps_dissim(..., add = TRUE)</code> is called.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function formats the input data as a <code>phylospatial</code> object. Beyond validating, cleaning, and restructing the data, the main operation
it performs is to compute community occurrence data for every internal clade on the tree. For a given clade and site, community data for
all the terminals in the clade are used to calculate the clade's occurrence value in the site. As described above, this calculation can
happen in various ways, depending on what type of community data you have (e.g. binary, probability, or abundance) and how you want to
summarize them. By default, the function tries to detect your <code>data_type</code> and use it to automatically select an appropriate summary
function as described above, but you can override this by providing your own function to <code>clade_fun</code>.</p>
<p>You can also disable construction of the clade community matrix columns altogether by setting <code>build = FALSE</code>). This is atypical, but you
might want to use this option if you have your own distribution data data on all clades (e.g. from modeling occurrence probabilities for
clades in addition to terminal species), or if your community data comes from a previously-constructed <code>phylospatial</code> object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># load species distribution data and phylogeny</span></span></span>
<span class="r-in"><span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"moss_comm.tif"</span>, package <span class="op">=</span> <span class="st">"phylospatial"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"moss_tree.nex"</span>, package <span class="op">=</span> <span class="st">"phylospatial"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># construct `phylospatial` object</span></span></span>
<span class="r-in"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu">phylospatial</span><span class="op">(</span><span class="va">comm</span>, <span class="va">tree</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Community data type detected: probability</span>
<span class="r-in"><span><span class="va">ps</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `phylospatial` object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 884 lineages across 1116 sites</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - community data type: probability </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - spatial data class: SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - dissimilarity data: none </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

