<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Alpha phylogenetic diversity • phylospatial</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Alpha phylogenetic diversity">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phylospatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/phylospatial-data.html">Spatial phylogentic data</a></li>
    <li><a class="dropdown-item" href="../articles/alpha-diversity.html">Alpha phylogenetic diversity</a></li>
    <li><a class="dropdown-item" href="../articles/beta-diversity.html">Phylogenetic beta diversity</a></li>
    <li><a class="dropdown-item" href="../articles/prioritization.html">Conservation prioritization</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matthewkling/phylospatial/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Alpha phylogenetic diversity</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/matthewkling/phylospatial/blob/master/vignettes/alpha-diversity.Rmd" class="external-link"><code>vignettes/alpha-diversity.Rmd</code></a></small>
      <div class="d-none name"><code>alpha-diversity.Rmd</code></div>
    </div>

    
    
<p>This vignette covers topics related to alpha diversity and endemism,
including calculation of basic diversity metrics as well as statistical
significance testing using null randomization.</p>
<p>To get started, let’s load the <code>phylospatial</code> library, as
well as <code>tmap</code> for visualization. Note that the functions
covered here all require a <code>phylospatial</code> object as input;
see <code><a href="../articles/phylospatial-data.html">vignette("phylospatial-data")</a></code> for details on
constructing data sets. We’ll use the <code><a href="../reference/moss.html">moss()</a></code> example data
here.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://matthewkling.github.io/phylospatial/">phylospatial</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moss.html">moss</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="diversity-measures">Diversity measures<a class="anchor" aria-label="anchor" href="#diversity-measures"></a>
</h2>
<p>The <code><a href="../reference/ps_diversity.html">ps_diversity()</a></code> function calculates the following
alpha diversity measures. While there are a wide variety of
phylogentically-informed diversity metrics in the literature, the
<code>phylospatial</code> package focuses primarily on “node-based”
diversity metrics like Faith’s PD that give equal treatment to
clades/branches at all levels. Phylogenetic diversity metrics can be
categorized as addressing richness, divergence, and regularity (Tucker
et al. 2017), as listed below. Note that an alternative approach to
assessing divergence is through null model analysis of richness metrics,
discussed later in this vignette.</p>
<p>Richness metrics: - PD: Phylogenetic diversity, i.e. total length of
all branch segments present in a location - PE: Phylogenetic endemism,
i.e. endemism-weighted PD - ShPD: Shannon’s pylogenetic diversity, a.k.a
“phylogenetic entropy” - ShPE: Shannon’s pylogenetic diversity, weighted
by endemism - SiPD: Simpson’s phylogenetic diversity - SiPE: Simpson’s
phylogenetic diversity, weighted by endemism - TR: Terminal richness,
i.e. richness of terminal taxa (in many cases these are species). For
binary data this is the total number of terminals in a site, while for
quantitative data it is the sum of probability or abundance values. -
TE: Terminal endemism, i.e. total endemism-weighted diversity of
terminal taxa (a.k.a. “weighted endemism”) - CR: Clade richness,
i.e. richness of taxa at all levels (equivalent to PD on a cladogram) -
CE: Clade endemism, i.e. total endemism-weighted diversity of taxa at
all levels (equivalent to PE on a cladrogram)</p>
<p>Divergence metrics: - RPD: Relative phylogenetic diversity, i.e. mean
branch segment length of residents (equivalent to PD / CR) - RPE:
Relative phylogenetic endemism, i.e. mean endemism-weighted branch
length (equivalent to PE / CE) - MPDT: Mean pairwise distance between
terminals, i.e. the classic MPD measure - MPDN: Mean pairwise distance
between nodes, a node-based version of MPD that calculates the average
branch length separating all pairs of collateral (non-lineal) nodes
including terminals and internal nodes, giving more representation to
deeper branches</p>
<p>Regularity metrics: - VPDT: Variance in pairwise distances between
terminals - VPDN: Variance in pairwise distances between collateral
nodes</p>
<p>All measures use quantitative community data if provided. “Endemism”
is the inverse of the total occurrence mass (the sum of presence,
probability, or abundance values) across all sites in the analysis. See
<code><a href="../reference/ps_diversity.html">?ps_diversity</a></code> for equations giving the derivation of each
metric.</p>
<p>Let’s compute the full set of metrics for our phylospatial data set.
Since our data is raster-based, by default the function will return a
<code>SpatRaster</code> with a layer for each measure. Here we’ll make
plots of PD and PE:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">div</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ps_diversity.html">ps_diversity</a></span><span class="op">(</span><span class="va">ps</span>, metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PD"</span>, <span class="st">"PE"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">div</span><span class="op">$</span><span class="va">PD</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"inferno"</span>, style <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="alpha-diversity_files/figure-html/alpha-1.png" width="576"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">div</span><span class="op">$</span><span class="va">PE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"inferno"</span>, style <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="alpha-diversity_files/figure-html/alpha-2.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="null-model-randomization">Null model randomization<a class="anchor" aria-label="anchor" href="#null-model-randomization"></a>
</h2>
<p>We can also use randomization to calculate the statistical
significance of these diversity metrics under a null model, using the
<code><a href="../reference/ps_rand.html">ps_rand()</a></code> function. By default, this function uses
<code><a href="../reference/quantize.html">quantize()</a></code>, a stratified randomization scheme designed for
use with continuous occurrence data, in combination with the
<code>"curveball"</code> algorithm.</p>
<p>Let’s run 25 randomizations (far more would be necessary for a real
analysis) for all metrics, and plot the results for PE. This is a
quantile value that gives the proportion of randomizations in which
observed PE was greater than randomized PE in a given grid cell. (If you
wanted to identify “statistically significant” grid cells in a
one-tailed test with alpha = 0.05, these would be cells with values
greater than 0.95.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ps_rand.html">ps_rand</a></span><span class="op">(</span><span class="va">ps</span>, n_rand <span class="op">=</span> <span class="fl">25</span>, progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PD"</span>, <span class="st">"PE"</span>, <span class="st">"CE"</span>, <span class="st">"RPE"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">rand</span><span class="op">$</span><span class="va">qPE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"inferno"</span>, style <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="alpha-diversity_files/figure-html/rand-1.png" width="576"></p>
<p>There are numerous alternative options for randomization algorithms
to use, depending on the type of occurrence data you have (probability,
binary, or abundance) and depending on which attributes of the terminal
community matrix (fill, row and column sums, etc.) you want to hold
fixed. In addition to the default function used above, these include a
basic <code>"tip_shuffle"</code> randomization, a range of algorithms
defined in the <code>vegan</code> package, and an option to supply a
custom randomization function. As a second example, here’s a
randomization with an abundance data set, using the
<code>"abuswap_c"</code> algorithm provided by
<code><a href="https://rdrr.io/pkg/vegan/man/nullmodel.html" class="external-link">vegan::nullmodel</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ps_simulate.html">ps_simulate</a></span><span class="op">(</span>data_type <span class="op">=</span> <span class="st">"abundance"</span>, metric <span class="op">=</span> <span class="st">"PD"</span><span class="op">)</span></span>
<span><span class="va">rand2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ps_rand.html">ps_rand</a></span><span class="op">(</span><span class="va">ps2</span>, fun <span class="op">=</span> <span class="st">"nullmodel"</span>, method <span class="op">=</span> <span class="st">"abuswap_c"</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="canape">CANAPE<a class="anchor" aria-label="anchor" href="#canape"></a>
</h2>
<p>Many things can be done with randomization results like the ones we
generated above. One thing you can do is use them to classify
significant endemism hotspots in a “categorical analysis of neo- and
paleo-endemism” (CANAPE, <a href="https://doi.org/10.1038/ncomms5473" class="external-link">Mishler et al. 2014</a>). The
function <code><a href="../reference/ps_canape.html">ps_canape()</a></code> uses significance values for PE, RPE,
and CE, which are returned by <code><a href="../reference/ps_rand.html">ps_rand()</a></code>, to categorize
sites into five endemism cateogories. Here’s an example with the moss
data; in this case, only three of the five categories occur in the
result (no areas of significant neo- or mixed-endemism are present):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ps_canape.html">ps_canape</a></span><span class="op">(</span><span class="va">rand</span>, alpha <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span></span></code></pre></div>
<p><img src="alpha-diversity_files/figure-html/canape-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
