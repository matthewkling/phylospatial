<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Conservation prioritization • phylospatial</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Conservation prioritization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phylospatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/phylospatial-data.html">Spatial phylogentic data</a></li>
    <li><a class="dropdown-item" href="../articles/alpha-diversity.html">Alpha phylogenetic diversity</a></li>
    <li><a class="dropdown-item" href="../articles/beta-diversity.html">Phylogenetic beta diversity</a></li>
    <li><a class="dropdown-item" href="../articles/prioritization.html">Conservation prioritization</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Conservation prioritization</h1>
            
      

      <div class="d-none name"><code>prioritization.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Phylogenetic diversity was originally conceived as a metric to inform
conservation, and spatial conservation planning is a core application of
spatial phylogenetics. Spatial conservation planning involves
identifying priority locations for actions like the creation of new
protected areas.</p>
<p>There are a diversity of sophisticated tools available for
conservation planning. This package performs conservation prioritization
using a stepwise algorithm that selects an ordered ranking of priority
sites for the creation of new protected areas. Unlike many other
algorithms, this method can utilize quantitative community data (rather
than just binary presence-absence data), and it can utilize quantitative
data on the relative degree of protection offered by different types of
protected area (rather than just binary protected-unprotected data).</p>
<p>Prioritization is handled by the function
<code><a href="../reference/ps_prioritize.html">ps_prioritize()</a></code>. A site’s priority ranking is a function
of:</p>
<ul>
<li>its current protection level</li>
<li>the occurrence quantities for all lineages present in the site,
including terminal taxa and larger clades</li>
<li>the evolutionary branch lengths of these lineages on the phylogeny,
which represent their unique evolutionary heritage</li>
<li>the impact that protecting the site would have on these lineages’
range-wide protection levels</li>
<li>the compositional complementarity between the site, other
high-priority sites, and existing protected areas</li>
<li>the relative cost of protecting the site</li>
<li>lambda, a free parameter determining the shape of the conservation
benefit function (see below)</li>
</ul>
<p>This vignette covers basic conservation optimization, probabilistic
prioritization, and further detail about conservation benefit
functions.</p>
</div>
<div class="section level2">
<h2 id="basic-optimization">Basic optimization<a class="anchor" aria-label="anchor" href="#basic-optimization"></a>
</h2>
<p>Let’s use the example data set for California mosses to perform a
conservation optimization that ranks every grid cell across the
state.</p>
<p>At every step of the iterative <code><a href="../reference/ps_prioritize.html">ps_prioritize()</a></code>
algorithm, the marginal value of fully protecting each individual site
is calculated. Under a basic optimization
(<code>method = "optimal"</code>), the site with the highest marginal
value is marked as protected, marginal values are re-calculated, and
this process is repeated until all sites (or <code>max_iter</code>
sites) are protected. Sites selected earlier in the process are
considered higher priority.</p>
<p>In addition to the required spatial phylogenetic data set, there are
two other optional data inputs that one might want to provide. The first
is <code>init</code>, the location and effectiveness of existing
protected areas. This can be binary data representing protected versus
unprotected sites, or continuous data with values between 0 and 1
representing the degree of protection (for example, perhaps because a
given spatial unit is only partially covered by protected land, or
because land management in sites like national forests is only partly
oriented toward biodiversity protection). During the conservation
optimization, the protection level for newly protected sites is raised
to 1 (or to an alternative level specified by the parameter
<code>level</code>), with greater benefit resulting from sites with
lower initial values.</p>
<p>The second optional variable is <code>cost</code>, representing the
relative cost of protecting different sites across the study area. Sites
with high benefit-to-cost ratios are prioritized. For this example,
we’ll just specify an arbitrary initial protection gradient from north
to south and a cost gradient from east to west, though of course a real
analysis would require actual data. For simplicity we’ll provide these
as vectors, but we could also provide raster layers matching the
<code>spatial</code> element of our data set.</p>
<p>First let’s load the libraries we’ll need, and initialize a
<code>phylospatial</code> data set using the example data for California
mosses. (See <code><a href="../articles/phylospatial-data.html">vignette("phylospatial-data")</a></code> for details on
constructing <code>phylospatial</code> objects.) We’ll also create a
variable called <code>con</code> specifying our (arbitrary) initial
conservation values, and pass it to <code><a href="../reference/ps_prioritize.html">ps_prioritize()</a></code> with
our spatial phylogenetic data. Plotting the result, the highest-priority
sites are those with low rank values, shown in yellow.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://matthewkling.github.io/phylospatial/">phylospatial</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moss.html">moss</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">comm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">comm</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">priority</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ps_prioritize.html">ps_prioritize</a></span><span class="op">(</span><span class="va">ps</span>, init <span class="op">=</span> <span class="va">init</span>, cost <span class="op">=</span> <span class="va">cost</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">priority</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"-inferno"</span>, style <span class="op">=</span> <span class="st">"log10"</span>,</span>
<span>                title <span class="op">=</span> <span class="st">"conservation\npriorities"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="prioritization_files/figure-html/optim-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="probabilistic-prioritization">Probabilistic prioritization<a class="anchor" aria-label="anchor" href="#probabilistic-prioritization"></a>
</h2>
<p>The routine shown above gives the optimal priority ranking, based on
the assumption that sites are selected in the optimal order. This is an
informative result and a relatively lightweight computation, but it has
limitations. First, assuming optimal behavior may be unrealistic. And
second, since the algorithm values complementarity (i.e. protection of
sites that have distinct, non-redundant biotic communities), sites with
high conservation value that could be attractive real-world priorities
can be entirely overlooked if they are compositionally similar to sites
that were already selected because they have slightly higher value.</p>
<p>Probabilistic prioritization, activated with
<code>method = "probable"</code>, addresses these issues. At each
iteration, instead of protecting the site with the highest marginal
value as done in the <code>"optimal"</code> method, this approach
protects a random site, selected with a probability that is a function
of the site’s marginal value. The trade-off is that individual runs of
the algorithm can be highly variable, so the algorithm needs to be run
many times, and prioritization rankings summarized across these repeated
runs. When using the probabilistic method, <code><a href="../reference/ps_prioritize.html">ps_prioritize()</a></code>
returns summary statistics for each site including its average priority
rank across reps, various quantiles of its rank distribution, and the
proportion of reps in which a site was among the top-ranked sites.</p>
<p>Running a large number of <code>n_reps</code> can substantially
increase computation times, but there are two ways to help mitigate run
times. First, you can use parallel processing by increasing
<code>n_cores</code> above the default of 1. Second, you can set
<code>max_iter</code> to a relatively small number, which stops the
algorithm after this number of sites have been added. For example, if
your data set has 1000 sites, setting <code>max_iter = 10</code> can
reduce run times by almost two orders of magnitude. While you won’t get
a full rank prioritization of all sites from any individual rep, you
will get the proportion of reps in which a site is in the top 10, which
is arguably even more useful.</p>
<p>Let’s demonstrate that here; we’ll use just 100 reps for expediency,
but 1000 or more would be better for a real analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priority</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ps_prioritize.html">ps_prioritize</a></span><span class="op">(</span><span class="va">ps</span>, init <span class="op">=</span> <span class="va">init</span>, cost <span class="op">=</span> <span class="va">cost</span>, n_reps <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">"prob"</span>, max_iter <span class="op">=</span> <span class="fl">10</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">priority</span><span class="op">$</span><span class="va">top10</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"inferno"</span>, style <span class="op">=</span> <span class="st">"cont"</span>,</span>
<span>                title <span class="op">=</span> <span class="st">"proporiton of runs\nin which site was\ntop-10 priority"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="prioritization_files/figure-html/prob-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="conservation-benefit-functions">Conservation benefit functions<a class="anchor" aria-label="anchor" href="#conservation-benefit-functions"></a>
</h2>
<p>In the examples above, we used the default value for the
<code>lambda</code> parameter. <code>lambda</code> controls the relative
priority placed on protecting initial populations of every taxon versus
more populations of more phylogenetically distinct taxa. More precisely,
it determines the shape of the <code><a href="../reference/benefit.html">benefit()</a></code> function that
converts the proportion of a taxon’s range that is protected into a
conservation benefit measure that is used in calculating the marginal
value of sites during prioritization.</p>
<p>We can use the function <code><a href="../reference/plot_lambda.html">plot_lambda()</a></code> to compare the
shapes of benefit functions under different lambda values:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_lambda.html">plot_lambda</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="prioritization_files/figure-html/lambda-1.png" width="432">
A value of <code>lambda = 0</code> places equal marginal value on
protecting additional populations of a taxon regardless of how much of
its range is already protected. The default of <code>lambda = 1</code>
places higher priority on protecting populations of unprotected taxa,
but still places some value on increasing the protection of taxa that
are already reasonably well protected. Increasing the value to
<code>lambda = 2</code> strongly emphasizes protecting the first few
percent of a taxon’s range, and places virtually no value on increasing
protection beyond 50%. Lambda can also be negative, which places greater
value on “finishing the job” of protecting the entire range of a lineage
than on “starting the job” of protection a portion of its range;
negative values are not likely to be useful in most practical
applications.</p>
<p>Deciding which value to use is a subjective choice, and you should
consider what makes the most sense for your particular use case. It can
also be useful to compare different values to understand how sensitive
your results may be to this choice.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
