<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Spatial phylogentic data • phylospatial</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial phylogentic data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phylospatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/phylospatial-data.html">Spatial phylogentic data</a></li>
    <li><a class="dropdown-item" href="../articles/alpha-diversity.html">Alpha phylogenetic diversity</a></li>
    <li><a class="dropdown-item" href="../articles/beta-diversity.html">Phylogenetic beta diversity</a></li>
    <li><a class="dropdown-item" href="../articles/prioritization.html">Conservation prioritization</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spatial phylogentic data</h1>
            
      

      <div class="d-none name"><code>phylospatial-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates the basic structure and creation of a
spatial phylogenetic data set, which is the first step of any analysis
using this R package. Spatial phylogenetic analyses require two
essential ingredients: data on the geographic distributions of a set of
organisms, and a phylogeny representing their evolutionary
relationships. This package stores these data as objects of of class
<code>'phylospatial'</code>.</p>
<p>The core idea of spatial phylogenetics is that analyses account for
every every single “lineage” on the phylogenetic tree, including
terminals and larger clades. Each lineage has a geographic range
comprising the collective ranges of all terminal(s) in the clade, and it
has a single branch segment whose length represents the evolutionary
history that is shared by those terminals and only those terminals. When
calculating biodiversity metrics, every lineage’s occurrence in a site
gets weighted by its branch length.</p>
<p>In this vignette, we’ll create a lightweight example of a
<code>phylospatial</code> object, look through its components to
understand how it is structured, and then demonstrate some more nuanced
use cases with real data. Finally, we’ll show how
<code>phylospatial</code> objects can also be used for traditional
non-phylogenetic biodiversity data analyses, in cases when incorporating
a phylogeny is impossible or undesirable.</p>
</div>
<div class="section level2">
<h2 id="a-minimal-example">A minimal example<a class="anchor" aria-label="anchor" href="#a-minimal-example"></a>
</h2>
<p>Let’s begin by creating a simple <code>phylospatial</code> object. To
do this, we use the <code><a href="../reference/phylospatial.html">phylospatial()</a></code> function, which has two
required arguments: <code>tree</code>, a phylogeny of class
<code>phylo</code>, and <code>comm</code>, a community data set
representing the geographic distributions of the terminal taxa (usually
species). In the code below, we simulate a random tree with five
terminal taxa, and a raster data set with 100 grid cells containing
occurrence probabilities for each terminal, with layer names
corresponding to species on the tree. (A differentiating feature of the
<code>phylospatial</code> library is that it supports quantitative data
types like probabilities or abundances, in addition to binary community
data.) Then we pass them to <code><a href="../reference/phylospatial.html">phylospatial()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://matthewkling.github.io/phylospatial/">phylospatial</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">n_taxa</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html" class="external-link">rtree</a></span><span class="op">(</span><span class="va">n_taxa</span><span class="op">)</span></span>
<span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">pi</span><span class="op">*</span><span class="fl">12</span>, length.out <span class="op">=</span> <span class="va">n_taxa</span> <span class="op">*</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, </span>
<span>                   dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">n_taxa</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span></span>
<span></span>
<span><span class="co"># create phylospatial object</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phylospatial.html">phylospatial</a></span><span class="op">(</span><span class="va">comm</span>, <span class="va">tree</span><span class="op">)</span></span>
<span><span class="va">ps</span></span>
<span><span class="co">#&gt; `phylospatial` object</span></span>
<span><span class="co">#&gt;   - 8 lineages across 100 sites</span></span>
<span><span class="co">#&gt;   - community data type: probability </span></span>
<span><span class="co">#&gt;   - spatial data class: SpatRaster </span></span>
<span><span class="co">#&gt;   - dissimilarity data: none</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="structure-of-a-phylospatial-object">Structure of a <code>phylospatial</code> object<a class="anchor" aria-label="anchor" href="#structure-of-a-phylospatial-object"></a>
</h2>
<div class="section level4">
<h4 id="phylogeny">Phylogeny<a class="anchor" aria-label="anchor" href="#phylogeny"></a>
</h4>
<p>Our <code>phylospatial</code> object is a list with six elements.
Let’s look at each of these in turn, starting with the
<code>tree</code>. This is the phylogeny we simulated, a tree of class
<code>phylo</code> with 5 tips and 3 larger clades. Note that the branch
lengths of the input tree are scaled to sum to 1. We can use
<code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> function to view the tree.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "comm"      "tree"      "spatial"   "data_type" "clade_fun" "dissim"</span></span>
<span></span>
<span><span class="va">ps</span><span class="op">$</span><span class="va">tree</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phylogenetic tree with 5 tips and 4 internal nodes.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tip labels:</span></span>
<span><span class="co">#&gt;   t5, t4, t3, t1, t2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rooted; includes branch length(s).</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ps</span>, <span class="st">"tree"</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylospatial-data_files/figure-html/tree-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="community-matrix">Community matrix<a class="anchor" aria-label="anchor" href="#community-matrix"></a>
</h4>
<p>The other key component is <code>comm</code>, which is a
<code>matrix</code> containing occurrence data. Although we supplied
community data as a raster, it’s stored here as a matrix, with a row for
each grid cell and a column for each taxon. Let’s take a look at the
matrix. We can also <code>plot</code> the community data, which re-casts
it as a spatial data set (a raster, in this case).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">comm</span><span class="op">)</span></span>
<span><span class="co">#&gt;         clade1    clade2        t5         t4    clade3          t3         t1</span></span>
<span><span class="co">#&gt; [1,] 0.9980319 0.9889042 0.5000000 0.97780849 0.8226247 0.781536164 0.18807934</span></span>
<span><span class="co">#&gt; [2,] 0.9953701 0.9919546 0.8428239 0.94881279 0.4245239 0.421627315 0.00500815</span></span>
<span><span class="co">#&gt; [3,] 0.9997640 0.9997100 0.9991060 0.67560320 0.1861159 0.104363637 0.09127841</span></span>
<span><span class="co">#&gt; [4,] 0.9517871 0.9194606 0.8838080 0.30684210 0.4013750 0.002378797 0.39994761</span></span>
<span><span class="co">#&gt; [5,] 0.9172596 0.5786829 0.5596673 0.04318460 0.8036150 0.171166120 0.76305863</span></span>
<span><span class="co">#&gt; [6,] 0.9936764 0.2254502 0.2030598 0.02809548 0.9918358 0.518882839 0.98303074</span></span>
<span><span class="co">#&gt;              t2</span></span>
<span><span class="co">#&gt; [1,] 0.03467274</span></span>
<span><span class="co">#&gt; [2,] 0.28671168</span></span>
<span><span class="co">#&gt; [3,] 0.65480785</span></span>
<span><span class="co">#&gt; [4,] 0.93866795</span></span>
<span><span class="co">#&gt; [5,] 0.98383430</span></span>
<span><span class="co">#&gt; [6,] 0.76573040</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ps</span>, <span class="st">"comm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylospatial-data_files/figure-html/comm-1.png" width="576"></p>
<p>We can see that in addition to our 5 terminal taxa, the data set also
includes geographic ranges for the 3 larger clades. Internally, the
<code><a href="../reference/phylospatial.html">phylospatial()</a></code> function constructs ranges for every
multi-tip clade on the tree, based on the topology of the tree and the
community data for the tips.</p>
<p>The specific way that these clade ranges are constructed depends on
the type of community data being used. The package supports three data
types: <code>"probability"</code>, <code>"abundance"</code>, and
<code>"binary"</code>. Recall that our data were probabilities; we could
have specified that explicitly by setting
<code>data_type = "probability"</code> when we constructed our
phylospatial object, but the function detected this based on the values
in our data set, and we can confirm that it did so correctly by checking
<code>ps$data_type</code>. For probabilities, the default function used
to calculate clade occurrence values gives the probability that at least
one member of the clade is present in a given site. Abundance and binary
data have their own default functions. (You can also override the
defaults by supplying your own <code>clade_fun</code>.) The function
that was used for a given data set can be accessed at
<code>ps$clade_fun</code>.</p>
<p>Note that you can also specify your own clade ranges to
<code><a href="../reference/phylospatial.html">phylospatial()</a></code> rather than letting it build them for you,
by setting <code>build = FALSE</code>. You might want to do this if, for
example, you have modeled the distributions of every clade in addition
to every terminal species in your data set.</p>
</div>
<div class="section level4">
<h4 id="spatial-data">Spatial data<a class="anchor" aria-label="anchor" href="#spatial-data"></a>
</h4>
<p>The <code>spatial</code> component is the last key piece of our
phylospatial object. (The only other element we haven’t mentioned here
is <code>dissim</code>, which is covered in the vignette on beta
diversity.) The spatial component of the object contains spatial
reference data on the geographic locations of the communities found in
each row of the community matrix.</p>
<p>In this example, the spatial data is a raster layer inherited from
the <code>SpatRaster</code> data we supplied as our <code>comm</code>.
You can also supply vector data (points, lines, or polygons) as an
<code>sf</code> object. Note also that spatial data isn’t required;
community data provided as a matrix works just fine.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>As we saw in above, example data sets can be useful for exploring
package functionality. This package includes one example empirical data
set, and a function for simulating toy <code>phylospatial</code> data
sets akin to the one we manually constructed above. These are used
throughout the other vignettes, and may be useful for your own
experimentation.</p>
<div class="section level4">
<h4 id="moss">
<code>moss</code><a class="anchor" aria-label="anchor" href="#moss"></a>
</h4>
<p>The package ships with one example <code>phylospatial</code> data
set, <code>moss</code>, that contains spatial phylogenetic data for
several hundred species of moss across California, based on species
distribution models and a bryophyte phylogeny. This is an occurrence
probability data set with <code>sf</code> polygon spatial data, as shown
in the first plot below. These same data are also available in different
spatial formats (raster vs. polygon) and data formats (binary
vs. probability) via the function <code><a href="../reference/moss_data.html">moss_data()</a></code>; the second
plot below shows binary occurrence data in raster format.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">moss</span>, <span class="st">"comm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylospatial-data_files/figure-html/moss-1.png" width="576"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/moss_data.html">moss_data</a></span><span class="op">(</span><span class="st">"binary"</span>, <span class="st">"raster"</span><span class="op">)</span>, <span class="st">"comm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylospatial-data_files/figure-html/moss-2.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="simulated-data">Simulated data<a class="anchor" aria-label="anchor" href="#simulated-data"></a>
</h4>
<p><code>phylospatial</code> data can also be simulated using the
function <code><a href="../reference/ps_simulate.html">ps_simulate()</a></code>. This function is intended to
produce simplistic data for examples and testing, not to produce
realistic data. While the moss data is only available in binary and
probability format due to the nature of the data, abundance data can be
simulated.</p>
</div>
<div class="section level4">
<h4 id="non-phylogenetic-data">Non-phylogenetic data<a class="anchor" aria-label="anchor" href="#non-phylogenetic-data"></a>
</h4>
<p>While the <code>phylospatial</code> library is obviously designed for
phylogenetic analyses, it’s worth noting that it also supports
non-phylogenetic analyses. In cases where a phylogeny is unavailable or
where a traditional species-based biodiversity analysis is desired, you
can create a data set by calling <code><a href="../reference/phylospatial.html">phylospatial()</a></code> without
providing a tree. All major functions in the package will still work,
and will assume that the taxa in <code>comm</code> are independent and
equally weighted.</p>
<p>In fact, traditional species-based methods can actually be considered
a specific case of more general phylogenetic methods, in which species
are assumed to be connected on a “star” phylogeny with a single polytomy
and equal branch lengths. In <code>phylospatial</code>, support for
non-phylogenetic data is implemented by creating a star phylogeny if no
phylogeny is provided by the user. Here’s how this looks for the simple
community data we created above:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phylospatial.html">phylospatial</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ps</span>, <span class="st">"tree"</span>, type <span class="op">=</span> <span class="st">"fan"</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylospatial-data_files/figure-html/species-1.png" width="576"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
